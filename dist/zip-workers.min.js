!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).zip={})}(this,(function(t){"use strict";const e="function";function n(t,n){return class{constructor(r){const i=t=>{if(this.pendingData){const e=this.pendingData;this.pendingData=new Uint8Array(e.length+t.length),this.pendingData.set(e,0),this.pendingData.set(t,e.length)}else this.pendingData=new Uint8Array(t)};if(this.codec=new t(Object.assign({},n,r)),typeof this.codec.onData==e)this.codec.onData=i;else{if(typeof this.codec.on!=e)throw new Error("Cannot register the callback function");this.codec.on("data",i)}}async append(t){return this.codec.push(t),r(this)}async flush(){return this.codec.push(new Uint8Array(0),!0),r(this)}};function r(t){if(t.pendingData){const e=t.pendingData;return t.pendingData=null,e}return new Uint8Array(0)}}const r=4294967295,i=65535,s=67324752,a=134695760,o=33639248,c=101010256,d=101075792,l=117853008,u=39169,h=2048;class p{constructor(){this.crc=-1,this.table=(()=>{const t=[];for(let e=0;e<256;e++){let n=e;for(let t=0;t<8;t++)1&n?n=n>>>1^3988292384:n>>>=1;t[e]=n}return t})()}append(t){const e=this.table;let n=0|this.crc;for(let r=0,i=0|t.length;r<i;r++)n=n>>>8^e[255&(n^t[r])];this.crc=n}get(){return~this.crc}}const w="Invalid pasword",f=16,g="raw",y={name:"PBKDF2"},m={name:"HMAC"},b="SHA-1",E={name:"AES-CTR"},A=Object.assign({hash:m},y),U=Object.assign({iterations:1e3,hash:{name:b}},y),R=Object.assign({hash:b},m),D=Object.assign({length:f},E),x=["deriveBits"],F=["sign"],S=528,v=10,k=[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],L=crypto.subtle;class I{constructor(t,e){this.password=t,this.signed=e,this.input=e&&new Uint8Array(0),this.pendingInput=new Uint8Array(0)}async append(t){const e=async(i=0)=>{if(i+f<=r.length-v){const t=r.subarray(i,i+f),s=await L.decrypt(Object.assign({counter:this.counter},D),this.keys.decrypt,t);return T(this.counter),n.set(new Uint8Array(s),i),e(i+f)}return this.pendingInput=r.subarray(i),this.signed&&(this.input=C(this.input,t)),n};if(this.password){const e=t.subarray(0,18);await async function(t,e,n){t.counter=new Uint8Array(k);const r=e.subarray(0,16),i=e.subarray(16),s=(new TextEncoder).encode(n),a=await L.importKey(g,s,A,!1,x),o=await L.deriveBits(Object.assign({salt:r},U),a,528),c=new Uint8Array(o),d=c.subarray(64);if(t.keys={decrypt:await L.importKey(g,c.subarray(0,32),E,!0,["decrypt"]),authentication:await L.importKey(g,c.subarray(32,64),R,!1,F),passwordVerification:d},d[0]!=i[0]||d[1]!=i[1])throw new Error(w)}(this,e,this.password),this.password=null,t=t.subarray(18)}let n=new Uint8Array(t.length-v-(t.length-v)%f),r=t;return this.pendingInput.length&&(r=C(this.pendingInput,t),n=z(n,r.length-v-(r.length-v)%f)),e()}async flush(){const t=this.pendingInput,e=this.keys,n=t.subarray(0,t.length-v),r=t.subarray(t.length-v);let i=new Uint8Array(0);if(n.length){const t=await L.decrypt(Object.assign({counter:this.counter},D),e.decrypt,n);i=new Uint8Array(t)}let s=!0;if(this.signed){const t=await L.sign(m,e.authentication,this.input.subarray(0,this.input.length-v)),n=new Uint8Array(t);this.input=null;for(let t=0;t<v;t++)n[t]!=r[t]&&(s=!1)}return{valid:s,data:i}}}class _{constructor(t){this.password=t,this.output=new Uint8Array(0),this.pendingInput=new Uint8Array(0)}async append(t){const e=async(i=0)=>{if(i+f<=t.length){const s=t.subarray(i,i+f),a=await L.encrypt(Object.assign({counter:this.counter},D),this.keys.encrypt,s);return T(this.counter),r.set(new Uint8Array(a),i+n.length),e(i+f)}return this.pendingInput=t.subarray(i),this.output=C(this.output,r),r};let n=new Uint8Array(0);this.password&&(n=await async function(t,e){t.counter=new Uint8Array(k);const n=crypto.getRandomValues(new Uint8Array(16)),r=(new TextEncoder).encode(e),i=await L.importKey(g,r,A,!1,x),s=await L.deriveBits(Object.assign({salt:n},U),i,S),a=new Uint8Array(s);return t.keys={encrypt:await L.importKey(g,a.subarray(0,32),E,!0,["encrypt"]),authentication:await L.importKey(g,a.subarray(32,64),R,!1,F),passwordVerification:a.subarray(64)},C(n,t.keys.passwordVerification)}(this,this.password),this.password=null);let r=new Uint8Array(n.length+t.length-t.length%f);return r.set(n,0),this.pendingInput.length&&(t=C(this.pendingInput,t),r=z(r,t.length-t.length%f)),e()}async flush(){let t=new Uint8Array(0);if(this.pendingInput.length){const e=await L.encrypt(Object.assign({counter:this.counter},D),this.keys.encrypt,this.pendingInput);t=new Uint8Array(e),this.output=C(this.output,t)}const e=await L.sign(m,this.keys.authentication,this.output.subarray(18));this.output=null;const n=new Uint8Array(e).subarray(0,v);return{data:C(t,n),signature:n}}}function T(t){for(let e=0;e<16;e++){if(255!=t[e]){t[e]++;break}t[e]=0}}function C(t,e){let n=t;return t.length+e.length&&(n=new Uint8Array(t.length+e.length),n.set(t,0),n.set(e,t.length)),n}function z(t,e){if(e&&e>t.length){const n=t;(t=new Uint8Array(e)).set(n,0)}return t}const M="deflate",W="inflate",N="Invalid signature";class O{constructor(t){this.signature=t.inputSignature,this.encrypted=Boolean(t.inputPassword),this.signed=t.inputSigned,this.compressed=t.inputCompressed,this.inflate=this.compressed&&new t.codecConstructor,this.crc32=this.signed&&this.signed&&new p,this.decrypt=this.encrypted&&new I(t.inputPassword)}async append(t){return this.encrypted&&(t=await this.decrypt.append(t)),this.compressed&&t.length&&(t=await this.inflate.append(t)),!this.encrypted&&this.signed&&this.crc32.append(t),t}async flush(){let t,e=new Uint8Array(0);if(this.encrypted){const t=await this.decrypt.flush();if(!t.valid)throw new Error(N);e=t.data}else if(this.signed){const e=new DataView(new Uint8Array(4).buffer);if(t=this.crc32.get(),e.setUint32(0,t),this.signature!=e.getUint32(0,!1))throw new Error(N)}return this.compressed&&(e=await this.inflate.append(e)||new Uint8Array(0),await this.inflate.flush()),{data:e,signature:t}}}class P{constructor(t){this.encrypted=t.outputEncrypted,this.signed=t.outputSigned,this.compressed=t.outputCompressed,this.deflate=this.compressed&&new t.codecConstructor({level:t.level||5}),this.crc32=this.signed&&new p,this.encrypt=this.encrypted&&new _(t.outputPassword)}async append(t){let e=t;return this.compressed&&t.length&&(e=await this.deflate.append(t)),this.encrypted?e=await this.encrypt.append(e):this.signed&&this.crc32.append(t),e}async flush(){let t,e=new Uint8Array(0);if(this.compressed&&(e=await this.deflate.flush()||new Uint8Array(0)),this.encrypted){e=await this.encrypt.append(e);const n=await this.encrypt.flush();t=n.signature;const r=new Uint8Array(e.length+n.data.length);r.set(e,0),r.set(n.data,e.length),e=r}else this.signed&&(t=this.crc32.get());return{data:e,signature:t}}}const B="init",V="append",j="flush",H="message";const Z={pool:[],pendingRequests:[]};function q(t,e){const n=Z.pool,r=!(t.inputCompressed||t.inputSigned||t.inputEncrypted||t.outputCompressed||t.outputSigned||t.outputEncrypted),i=t.useWebWorkers||void 0===t.useWebWorkers&&e.useWebWorkers&&!r;let s;if(i){const n=t.codecType;e.workerScripts?s=e.workerScripts[n]:t.workerScriptsPath=(e.workerScriptsPath||"")+"z-worker.js"}if(n.length<e.maxWorkers){const e={};return n.push(e),K(e,t,i,s)}{const e=n.find((t=>!t.busy));return e?K(e,t,i,s):new Promise((e=>Z.pendingRequests.push({resolve:e,options:t,webWorker:i,scripts:s})))}}function K(t,e,n,r){return t.busy=!0,t.options=e,t.scripts=r,t.webWorker=n,n?function(t,e){let n;t.interface||(t.scripts?t.worker=new Worker(new URL(t.scripts[0],"undefined"==typeof document?new(require("url").URL)("file:"+__filename).href:document.currentScript&&document.currentScript.src||new URL("zip-workers.min.js",document.baseURI).href)):t.worker=new Worker(new URL(e.workerScriptsPath,"undefined"==typeof document?new(require("url").URL)("file:"+__filename).href:document.currentScript&&document.currentScript.src||new URL("zip-workers.min.js",document.baseURI).href)),t.worker.addEventListener(H,s,!1),t.interface={append:t=>r({type:V,data:t}),flush:()=>r({type:j})});return t.interface;async function r(e){if(!n){const e=t.options,n=t.scripts?t.scripts.slice(1):[];await i(Object.assign({scripts:n,type:B,options:{codecType:e.codecType,inputPassword:e.inputPassword,inputSigned:e.inputSigned,inputSignature:e.signature,inputCompressed:e.inputCompressed,inputEncrypted:e.inputEncrypted,level:e.level,outputPassword:e.outputPassword,outputSigned:e.outputSigned,outputCompressed:e.outputCompressed,outputEncrypted:e.outputEncrypted}}))}return i(e)}function i(e){const r=t.worker,i=new Promise(((t,e)=>n={resolve:t,reject:e}));try{if(e.data)try{r.postMessage(e,[e.data.buffer])}catch(t){r.postMessage(e)}else r.postMessage(e)}catch(e){n.reject(e),n=null,Y(t)}return i}function s(e){const r=e.data;if(n){const e=r.error;if(e){const r=new Error(e.message);r.stack=e.stack,n.reject(r),n=null,Y(t)}else r.type!=B&&r.type!=j&&r.type!=V||(r.type==j?(n.resolve({data:new Uint8Array(r.data),signature:r.signature}),n=null,Y(t)):n.resolve(r.data&&new Uint8Array(r.data)))}}}(t,e):function(t){const e=function(t){return t.codecType.startsWith(M)?new P(t):t.codecType.startsWith(W)?new O(t):void 0}(t.options);return{async append(n){try{return await e.append(n)}catch(e){throw Y(t),e}},async flush(){try{return await e.flush()}finally{Y(t)}}}}(t)}function Y(t){if(t.busy=!1,Z.pendingRequests.length){const[{resolve:e,options:n,webWorker:r,scripts:i}]=Z.pendingRequests.splice(0,1);e(K(t,n,r,i))}else t.worker&&t.worker.terminate(),Z.pool=Z.pool.filter((e=>e!=t))}async function X(t,e,n,r,i,s,a){const o=Math.max(s.chunkSize,64);return async function s(c=0,d=0){const l=c*o;if(l<i){const u=await e.readUint8Array(l+r,Math.min(o,i-l)),h=await t.append(u);return d+=await G(n,h),a.onprogress&&a.onprogress(l+u.length,i),s(c+1,d)}{const e=await t.flush();return d+=await G(n,e.data),{signature:e.signature,length:d}}}()}async function G(t,e){return e.length&&await t.writeUint8Array(e),e.length}const J=["filename","rawFilename","directory","encrypted","compressedSize","uncompressedSize","lastModDate","rawLastModDate","comment","rawComment","signature","extraField","rawExtraField","bitFlag","extraFieldZip64","extraFieldUnicodePath","extraFieldUnicodeComment","extraFieldAES"];class Q{constructor(t){J.forEach((e=>this[e]=t[e]))}}const $="File format is not recognized",tt="End of central directory not found",et="End of Zip64 central directory not found",nt="End of Zip64 central directory locator not found",rt="Central directory header not found",it="Local file header not found",st="Zip64 extra field not found",at="File contains encrypted entry",ot="Encryption not supported",ct="Compression method not supported",dt="utf-8",lt=["uncompressedSize","compressedSize","offset"],ut=["\0","☺","☻","♥","♦","♣","♠","•","◘","○","◙","♂","♀","♪","♫","☼","►","◄","↕","‼","¶","§","▬","↨","↑","↓","→","←","∟","↔","▲","▼"," ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/","0","1","2","3","4","5","6","7","8","9",":",";","<","=",">","?","@","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","[","\\","]","^","_","`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~","⌂","Ç","ü","é","â","ä","à","å","ç","ê","ë","è","ï","î","ì","Ä","Å","É","æ","Æ","ô","ö","ò","û","ù","ÿ","Ö","Ü","¢","£","¥","₧","ƒ","á","í","ó","ú","ñ","Ñ","ª","º","¿","⌐","¬","½","¼","¡","«","»","░","▒","▓","│","┤","╡","╢","╖","╕","╣","║","╗","╝","╜","╛","┐","└","┴","┬","├","─","┼","╞","╟","╚","╔","╩","╦","╠","═","╬","╧","╨","╤","╥","╙","╘","╒","╓","╫","╪","┘","┌","█","▄","▌","▐","▀","α","ß","Γ","π","Σ","σ","µ","τ","Φ","Θ","Ω","δ","∞","φ","ε","∩","≡","±","≥","≤","⌠","⌡","÷","≈","°","∙","·","√","ⁿ","²","■"," "];class ht{constructor(t,e,n){this.reader=t,this.config=e,this.options=n}async getData(t,e={}){const n=this.reader;n.initialized||await n.init();const r=await n.readUint8Array(this.offset,30),i=new DataView(r.buffer),a=void 0===e.password?this.options.password:e.password;let o=a&&a.length&&a;if(this.extraFieldAES){if(99!=this.extraFieldAES.originalCompressionMethod)throw new Error(ct);if(3!=this.extraFieldAES.strength)throw new Error(ot)}if(0!=this.compressionMethod&&8!=this.compressionMethod)throw new Error(ct);if(bt(i,0)!=s)throw new Error(it);const c=this.localDirectory={};pt(c,i,4),c.rawExtraField=r.subarray(this.offset+30+c.filenameLength,this.offset+30+c.filenameLength+c.extraFieldLength),wt(this,c,i,4);let d=this.offset+30+c.filenameLength+c.extraFieldLength;const l=this.bitFlag.encrypted&&c.bitFlag.encrypted;if(l&&!o)throw new Error(at);const u=await q({codecType:W,codecConstructor:this.config.Inflate,inputPassword:o,inputSigned:void 0===e.checkSignature?this.options.checkSignature:e.checkSignature,inputSignature:this.signature,inputCompressed:0!=this.compressionMethod,inputEncrypted:l,useWebWorkers:void 0===e.useWebWorkers?this.options.useWebWorkers:e.useWebWorkers},this.config);return t.initialized||await t.init(),await X(u,n,t,d,this.compressedSize,this.config,{onprogress:e.onprogress}),t.getData()}}function pt(t,e,n){t.version=mt(e,n);const r=t.rawBitFlag=mt(e,n+2);t.bitFlag={encrypted:1==(1&r),level:(6&r)>>1,dataDescriptor:8==(8&r),languageEncodingFlag:(r&h)==h},t.encrypted=t.bitFlag.encrypted,t.rawLastModDate=bt(e,n+6),t.lastModDate=function(t){const e=(4294901760&t)>>16,n=65535&t;try{return new Date(1980+((65024&e)>>9),((480&e)>>5)-1,31&e,(63488&n)>>11,(2016&n)>>5,2*(31&n),0)}catch(t){}}(t.rawLastModDate),t.filenameLength=mt(e,n+22),t.extraFieldLength=mt(e,n+24)}function wt(t,e,n,i){const s=e.rawExtraField,a=e.extraField=new Map,o=new DataView(new Uint8Array(s).buffer);let c=0;try{for(;c<s.length;){const t=mt(o,c),e=mt(o,c+2);a.set(t,{type:t,data:s.slice(c+4,c+4+e)}),c+=4+e}}catch(t){}const d=mt(n,i+4);e.signature=bt(n,i+10),e.uncompressedSize=bt(n,i+18),e.compressedSize=bt(n,i+14);const l=e.extraFieldZip64=a.get(1);l&&function(t,e){e.zip64=!0;const n=new DataView(t.data.buffer);t.values=[];for(let e=0;e<Math.floor(t.data.length/8);e++)t.values.push(Number(Et(n,0+8*e)));const i=lt.filter((t=>e[t]==r));for(let e=0;e<i.length;e++)t[i[e]]=t.values[e];lt.forEach((n=>{if(e[n]==r){if(!t||void 0===t[n])throw new Error(st);e[n]=t[n]}}))}(l,e);const u=e.extraFieldUnicodePath=a.get(28789);u&&ft(u,"filename","rawFilename",e,t);let h=e.extraFieldUnicodeComment=a.get(25461);h&&ft(h,"comment","rawComment",e,t);const p=e.extraFieldAES=a.get(39169);p?function(t,e,n){if(t){const r=new DataView(t.data.buffer);t.vendorVersion=yt(r,0),t.vendorId=yt(r,2);const i=yt(r,4);t.strength=i,t.originalCompressionMethod=n,e.compressionMethod=t.compressionMethod=mt(r,5)}else e.compressionMethod=n}(p,e,d):e.compressionMethod=d,8==e.compressionMethod&&(e.bitFlag.enhancedDeflating=16!=(16&e.rawBitFlag))}function ft(t,e,n,r,i){const s=new DataView(t.data.buffer);t.version=yt(s,0),t.signature=bt(s,1);const a=new p;a.append(i[n]);const o=new DataView(new Uint8Array(4).buffer);o.setUint32(0,a.get(),!0),t[e]=(new TextDecoder).decode(t.data.subarray(5)),t.valid=!i.bitFlag.languageEncodingFlag&&t.signature==bt(o,0),t.valid&&(r[e]=t[e])}function gt(t,e){if(e&&"cp437"!=e.trim().toLowerCase())return new TextDecoder(e).decode(t);{let e="";for(let n=0;n<t.length;n++)e+=ut[t[n]];return e}}function yt(t,e){return t.getUint8(e)}function mt(t,e){return t.getUint16(e,!0)}function bt(t,e){return t.getUint32(e,!0)}function Et(t,e){return t.getBigUint64(e,!0)}const At="HTTP error ",Ut="HTTP Range not supported",Rt="text/plain";class Dt{constructor(){this.size=0}init(){this.initialized=!0}}class xt extends Dt{}class Ft extends Dt{writeUint8Array(t){this.size+=t.length}}class St extends xt{constructor(t){super(),this.blob=t,this.size=t.size}readUint8Array(t,e){const n=new FileReader;return new Promise(((r,i)=>{n.onload=t=>r(new Uint8Array(t.target.result)),n.onerror=i,n.readAsArrayBuffer(this.blob.slice(t,t+e))}))}}class vt extends Ft{constructor(){super(),this.array=new Uint8Array(0)}writeUint8Array(t){super.writeUint8Array(t);const e=this.array;this.array=new Uint8Array(e.length+t.length),this.array.set(e),this.array.set(t,e.length)}getData(){return this.array}}function kt(t,e){return new Promise(((n,r)=>{const i=new XMLHttpRequest;i.addEventListener("load",(()=>{i.status<400?(t.size||(t.size=Number(i.getResponseHeader("Content-Length"))||Number(i.response.byteLength)),t.data=new Uint8Array(i.response),n()):r(At+(i.statusText||i.status)+".")}),!1),i.addEventListener("error",r,!1),i.open("GET",e),i.responseType="arraybuffer",i.send()}))}const Lt="File already exists",It="Zip file comment exceeds 64KB",_t="File entry comment exceeds 64KB",Tt="File entry name exceeds 64KB",Ct="Version exceeds 65535",zt="The minimum year for the date is 1980",Mt="Extra field type exceeds 65535",Wt="Extra field data exceeds 64KB",Nt=new Uint8Array([7,0,2,0,65,69,3,0,0]);function Ot(t,e,n){t.setUint8(e,n)}function Pt(t,e,n){t.setUint16(e,n,!0)}function Bt(t,e,n){t.setUint32(e,n,!0)}function Vt(t,e,n){t.setBigUint64(e,n,!0)}const jt={chunkSize:524288,maxWorkers:"undefined"!=typeof navigator&&navigator.hardwareConcurrency||2,workerScriptsPath:void 0,useWebWorkers:!0};let Ht=Object.assign({},jt);t.BlobReader=St,t.BlobWriter=class extends Ft{constructor(t){super(),this.offset=0,this.contentType=t,this.blob=new Blob([],{type:t})}writeUint8Array(t){super.writeUint8Array(t),this.blob=new Blob([this.blob,t.buffer],{type:this.contentType}),this.offset=this.blob.size}getData(){return this.blob}},t.Data64URIReader=class extends xt{constructor(t){super(),this.dataURI=t;let e=t.length;for(;"="==t.charAt(e-1);)e--;this.dataStart=t.indexOf(",")+1,this.size=Math.floor(.75*(e-this.dataStart))}readUint8Array(t,e){const n=new Uint8Array(e),r=4*Math.floor(t/3),i=atob(this.dataURI.substring(r+this.dataStart,4*Math.ceil((t+e)/3)+this.dataStart)),s=t-3*Math.floor(r/4);for(let t=s;t<s+e;t++)n[t-s]=i.charCodeAt(t);return n}},t.Data64URIWriter=class extends Ft{constructor(t){super(),this.data="data:"+(t||"")+";base64,",this.pending=[]}writeUint8Array(t){super.writeUint8Array(t);let e=0,n=this.pending;const r=this.pending.length;for(this.pending="",e=0;e<3*Math.floor((r+t.length)/3)-r;e++)n+=String.fromCharCode(t[e]);for(;e<t.length;e++)this.pending+=String.fromCharCode(t[e]);n.length>2?this.data+=btoa(n):this.pending=n}getData(){return this.data+btoa(this.pending)}},t.ERR_BAD_FORMAT=$,t.ERR_CENTRAL_DIRECTORY_NOT_FOUND=rt,t.ERR_DUPLICATED_NAME=Lt,t.ERR_ENCRYPTED=at,t.ERR_EOCDR_LOCATOR_ZIP64_NOT_FOUND=nt,t.ERR_EOCDR_NOT_FOUND=tt,t.ERR_EOCDR_ZIP64_NOT_FOUND=et,t.ERR_EXTRAFIELD_ZIP64_NOT_FOUND=st,t.ERR_HTTP_RANGE=Ut,t.ERR_INVALID_COMMENT=It,t.ERR_INVALID_DATE=zt,t.ERR_INVALID_ENTRY_COMMENT=_t,t.ERR_INVALID_ENTRY_NAME=Tt,t.ERR_INVALID_EXTRAFIELD_DATA=Wt,t.ERR_INVALID_EXTRAFIELD_TYPE=Mt,t.ERR_INVALID_PASSORD=w,t.ERR_INVALID_SIGNATURE=N,t.ERR_INVALID_VERSION=Ct,t.ERR_LOCAL_FILE_HEADER_NOT_FOUND=it,t.ERR_UNSUPPORTED_COMPRESSION=ct,t.ERR_UNSUPPORTED_ENCRYPTION=ot,t.HttpRangeReader=class extends xt{constructor(t){super(),this.url=t}init(){return super.init(),new Promise(((t,e)=>{const n=new XMLHttpRequest;n.addEventListener("load",(()=>{n.status<400?(this.size=Number(n.getResponseHeader("Content-Length")),"bytes"==n.getResponseHeader("Accept-Ranges")?t():e(new Error(Ut))):e(At+(n.statusText||n.status)+".")}),!1),n.addEventListener("error",e,!1),n.open("HEAD",this.url),n.send()}))}readUint8Array(t,e){return new Promise(((n,r)=>{const i=new XMLHttpRequest;i.open("GET",this.url),i.responseType="arraybuffer",i.setRequestHeader("Range","bytes="+t+"-"+(t+e-1)),i.addEventListener("load",(()=>{i.status<400?n(new Uint8Array(i.response)):r(At+(i.statusText||i.status)+".")}),!1),i.addEventListener("error",r,!1),i.send()}))}},t.HttpReader=class extends xt{constructor(t){super(),this.url=t}async init(){if(super.init(),function(t){if("undefined"!=typeof document){const e=document.createElement("a");return e.href=t,"http:"==e.protocol||"https:"==e.protocol}return/^https?:\/\//i.test(t)}(this.url))return new Promise(((t,e)=>{const n=new XMLHttpRequest;n.addEventListener("load",(()=>{n.status<400?(this.size=Number(n.getResponseHeader("Content-Length")),this.size?t():kt().then((()=>t())).catch(e)):e(At+(n.statusText||n.status)+".")}),!1),n.addEventListener("error",e,!1),n.open("HEAD",this.url),n.send()}));await kt()}async readUint8Array(t,e){return this.data||await kt(this,this.url),new Uint8Array(this.data.subarray(t,t+e))}},t.Reader=xt,t.TextReader=class extends xt{constructor(t){super(),this.blobReader=new St(new Blob([t],{type:Rt}))}init(){super.init(),this.blobReader.init(),this.size=this.blobReader.size}readUint8Array(t,e){return this.blobReader.readUint8Array(t,e)}},t.TextWriter=class extends Ft{constructor(t){super(),this.encoding=t,this.blob=new Blob([],{type:Rt})}writeUint8Array(t){super.writeUint8Array(t),this.blob=new Blob([this.blob,t.buffer],{type:Rt})}getData(){const t=new FileReader;return new Promise(((e,n)=>{t.onload=t=>e(t.target.result),t.onerror=n,t.readAsText(this.blob,this.encoding)}))}},t.Uint8ArrayReader=class extends xt{constructor(t){super(),this.array=t,this.size=t.length}readUint8Array(t,e){return this.array.slice(t,t+e)}},t.Uint8ArrayWriter=vt,t.Writer=Ft,t.ZipReader=class extends class{constructor(t,e={},n={}){this.reader=t,this.options=e,this.config=n}async getEntries(t={}){const e=this.reader;e.initialized||await e.init();const n=await async function(t,e,n,r){const i=new Uint8Array(4);if(function(t,e,n){t.setUint32(e,n,!0)}(new DataView(i.buffer),0,e),t.size<n)throw new Error($);const s=n+r;let a=n,o=await c(a);o||(o=await c(Math.min(s,t.size)));return o;async function c(e){const r=t.size-e,s=await t.readUint8Array(r,e);for(let t=s.length-n;t>=0;t--)if(s[t]==i[0]&&s[t+1]==i[1]&&s[t+2]==i[2]&&s[t+3]==i[3])return{offset:r,buffer:s.slice(t,t+n).buffer}}}(e,c,22,i);if(!n)throw new Error(tt);const s=new DataView(n.buffer);let a,u=bt(s,16),h=mt(s,8);if(u==r||h==i){a=!0;const t=await e.readUint8Array(n.offset-20,20),r=new DataView(t.buffer);if(Number(bt(r,0))!=l)throw new Error(et);u=Number(Et(r,8));const i=await e.readUint8Array(u,56),s=new DataView(i.buffer);if(Number(bt(s,0))!=d)throw new Error(nt);h=Number(Et(s,24)),u-=Number(Et(s,40))}if(u<0||!a&&(u>=e.size||h>=i))throw new Error($);const p=await e.readUint8Array(u,e.size-u),w=new DataView(p.buffer),f=[];let g=0;for(let e=0;e<h;e++){const e=new ht(this.reader,this.config,this.options);if(bt(w,g)!=o)throw new Error(rt);e.compressedSize=0,e.uncompressedSize=0,pt(e,w,g+6),e.commentLength=mt(w,g+32),e.directory=16==(16&yt(w,g+38)),e.offset=bt(w,g+42),e.rawFilename=p.subarray(g+46,g+46+e.filenameLength);const n=void 0===t.filenameEncoding?this.options.filenameEncoding:t.filenameEncoding;e.filename=gt(e.rawFilename,e.bitFlag.languageEncodingFlag?dt:n),!e.directory&&e.filename&&"/"==e.filename.charAt(e.filename.length-1)&&(e.directory=!0),e.rawExtraField=p.subarray(g+46+e.filenameLength,g+46+e.filenameLength+e.extraFieldLength),wt(e,e,w,g+6),e.rawComment=p.subarray(g+46+e.filenameLength+e.extraFieldLength,g+46+e.filenameLength+e.extraFieldLength+e.commentLength);const r=void 0===t.commentEncoding?this.options.commentEncoding:t.commentEncoding;e.comment=gt(e.rawComment,e.bitFlag.languageEncodingFlag?dt:r);const i=new Q(e);i.getData=(t,n)=>e.getData(t,n),f.push(i),g+=46+e.filenameLength+e.extraFieldLength+e.commentLength}return f}async close(){}}{constructor(t,e){super(t,e,Ht)}},t.ZipWriter=class extends class{constructor(t,e={},n={}){this.writer=t,this.options=e,this.config=n,this.files=new Map,this.offset=t.size}async add(t="",e,n={}){if(t=t.trim(),!n.directory||t.length&&"/"==t.charAt(t.length-1)||(t+="/"),this.files.has(t))throw new Error(Lt);const o=(new TextEncoder).encode(t);if(o.length>i)throw new Error(Tt);const c=n.comment||"",d=(new TextEncoder).encode(c);if(d.length>i)throw new Error(_t);const l=this.options.version||n.version||0;if(l>i)throw new Error(Ct);const h=n.lastModDate||new Date;if(h.getFullYear()<1980)throw new Error(zt);e&&!e.initialized&&await e.init();let p=new Uint8Array(0);const w=n.extraField;if(w){let t=4,e=0;w.forEach((e=>t+=e.length)),p=new Uint8Array(t),w.forEach(((t,n)=>{if(n>i)throw new Error(Mt);if(t.length>i)throw new Error(Wt);p.set(new Uint16Array([n]),e),p.set(new Uint16Array([t.length]),e+2),p.set(t,e+4),e+=4+t.length}))}const f=n.zip64||this.options.zip64||this.offset>=r||e&&(e.size>=r||this.offset+e.size>=r),g=void 0===n.password?this.options.password:n.password,y=void 0===n.level?this.options.level:n.level,m=void 0===n.useWebWorkers?this.options.useWebWorkers:n.useWebWorkers,b=await async function(t,e,n,i){const o=t.files,c=t.writer;let d;o.set(e,null);try{let l,h;try{i.bufferedWrite||t.options.bufferedWrite||t.lockWrite?(l=new vt,l.init()):(t.lockWrite=new Promise((t=>d=t)),c.initialized||await c.init(),l=c),h=await async function(t,e,n,i){const o=i.rawFilename,c=i.lastModDate,d=i.password,l=Boolean(d&&d.length),h=i.level,p=0!==h&&!i.directory,w=i.zip64;let f;if(l){f=new Uint8Array(Nt.length+2);Pt(new DataView(f.buffer),0,u),f.set(Nt,2)}else f=new Uint8Array(0);const g={version:i.version||20,zip64:w,directory:Boolean(i.directory),rawFilename:o,rawComment:i.rawComment,rawExtraFieldZip64:w?new Uint8Array(28):new Uint8Array(0),rawExtraFieldAES:f,rawExtraField:i.rawExtraField};let y=2056,m=0;p&&(m=8);w&&(g.version=g.version>45?g.version:45);l&&(g.version=g.version>51?g.version:51,y|=1,m=99,p&&(g.rawExtraFieldAES[9]=8));const b=g.headerArray=new Uint8Array(26),E=new DataView(b.buffer);Pt(E,0,g.version),Pt(E,2,y),Pt(E,4,m),Pt(E,6,(c.getHours()<<6|c.getMinutes())<<5|c.getSeconds()/2),Pt(E,8,(c.getFullYear()-1980<<4|c.getMonth()+1)<<5|c.getDate()),Pt(E,22,o.length),Pt(E,24,0);const A=E.getUint32(6,!0),U=new Uint8Array(30+o.length);Bt(new DataView(U.buffer),0,s),U.set(b,4),U.set(o,30);let R,D=0,x=0;if(t){D=t.size;const r=await q({codecType:M,codecConstructor:n.Deflate,level:h,outputPassword:d,outputSigned:!0,outputCompressed:p,outputEncrypted:l,useWebWorkers:i.useWebWorkers},n);await e.writeUint8Array(U),R=await X(r,t,e,0,D,n,{onprogress:i.onprogress}),x=R.length}else await e.writeUint8Array(U);const F=new Uint8Array(w?24:16),S=new DataView(F.buffer);if(Bt(S,0,a),t)if(l||void 0===R.signature||(Bt(E,10,R.signature),Bt(S,4,R.signature),g.signature=R.signature),w){const t=new DataView(g.rawExtraFieldZip64.buffer);Pt(t,0,1),Pt(t,2,24),Bt(E,14,r),Vt(S,8,BigInt(x)),Vt(t,12,BigInt(x)),Bt(E,18,r),Vt(S,16,BigInt(D)),Vt(t,4,BigInt(D))}else Bt(E,14,x),Bt(S,8,x),Bt(E,18,D),Bt(S,12,D);return await e.writeUint8Array(F),g.compressedSize=x,g.uncompressedSize=D,g.lastModDate=c,g.rawLastModDate=A,g.encrypted=l,g.length=U.length+(R?R.length:0)+F.length,g}(n,l,t.config,i)}catch(t){throw o.delete(e),t}if(o.set(e,h),l!=c&&(t.lockWrite&&await t.lockWrite,await c.writeUint8Array(l.getData())),h.offset=t.offset,h.zip64){Vt(new DataView(h.rawExtraFieldZip64.buffer),20,BigInt(h.offset))}return t.offset+=h.length,h}finally{d&&(t.lockWrite=null,d())}}(this,t,e,Object.assign({},n,{rawFilename:o,rawComment:d,version:l,lastModDate:h,rawExtraField:p,zip64:f,password:g,level:y,useWebWorkers:m}));return b.filename=t,b.comment=c,b.extraField=w,new Q(b)}async close(t=new Uint8Array(0)){const e=this.writer,n=this.files;let s=0,a=0,u=this.offset,h=n.size;if(t.length){if(!(t.length<=i))throw new Error(It);Pt(f,s+20,t.length)}for(const[,t]of n)a+=46+t.rawFilename.length+t.rawComment.length+t.rawExtraFieldZip64.length+t.rawExtraFieldAES.length+t.rawExtraField.length;const p=this.options.zip64||u+a>=r||h>=i,w=new Uint8Array(a+(p?98:22)),f=new DataView(w.buffer);for(const[,t]of n){const e=t.rawFilename,n=t.rawExtraFieldZip64,i=t.rawExtraFieldAES,a=n.length+i.length+t.rawExtraField.length;Bt(f,s,o),Pt(f,s+4,t.version),w.set(t.headerArray,s+6),Pt(f,s+30,a),Pt(f,s+32,t.rawComment.length),t.directory&&Ot(f,s+38,16),t.zip64?Bt(f,s+42,r):Bt(f,s+42,t.offset),w.set(e,s+46),w.set(n,s+46+e.length),w.set(i,s+46+e.length+n.length),w.set(t.rawExtraField,46+e.length+n.length+i.length),w.set(t.rawComment,s+46+e.length+a),s+=46+e.length+a+t.rawComment.length}return p&&(Bt(f,s,d),Vt(f,s+4,BigInt(44)),Pt(f,s+12,45),Pt(f,s+14,45),Vt(f,s+24,BigInt(h)),Vt(f,s+32,BigInt(h)),Vt(f,s+40,BigInt(a)),Vt(f,s+48,BigInt(u)),Bt(f,s+56,l),Vt(f,s+64,BigInt(u+a)),Bt(f,s+72,1),h=i,u=r,s+=76),Bt(f,s,c),Pt(f,s+8,h),Pt(f,s+10,h),Bt(f,s+12,a),Bt(f,s+16,u),await e.writeUint8Array(w),await e.writeUint8Array(t),e.getData()}}{constructor(t,e){super(t,e,Ht)}},t.configure=function(t){if(Ht=Object.assign({},Ht,t),null!=Ht.workerScripts&&null!=Ht.workerScriptsPath)throw new Error("Either workerScripts or workerScriptsPath may be set, not both");if(Ht.workerScripts){if(Ht.workerScripts.deflate&&!Array.isArray(Ht.workerScripts.deflate))throw new Error("workerScripts.deflate must be an array");if(Ht.workerScripts.inflate&&!Array.isArray(Ht.workerScripts.inflate))throw new Error("workerScripts.inflate must be an array")}},t.getMimeType=function(){return"application/octet-stream"},t.initShimAsyncCodec=(t,e={})=>({Deflate:n(t.Deflate,e.deflate),Inflate:n(t.Inflate,e.inflate)}),Object.defineProperty(t,"__esModule",{value:!0})}));
